# Digital Ocean Environment Variables Template
# Copy these to your Digital Ocean App Platform dashboard under Settings > Environment Variables

# =============================================================================
# REQUIRED ENVIRONMENT VARIABLES
# =============================================================================

# Next.js Configuration
NODE_ENV=production

# NextAuth Configuration
# Generate NEXTAUTH_SECRET with: openssl rand -base64 32
NEXTAUTH_SECRET=your-nextauth-secret-here-replace-with-generated-value
NEXTAUTH_URL=${APP_URL}

# Database Configuration (Auto-populated by Digital Ocean)
# These will be automatically set by Digital Ocean when you add the database service
DATABASE_URL=${bookedsolid-db.DATABASE_URL}
DIRECT_DATABASE_URL=${bookedsolid-db.DATABASE_URL}

# Retell AI Configuration
# Get these from your Retell AI dashboard at https://app.retellai.com
RETELL_WEBHOOK_SECRET=your-retell-webhook-secret-here
RETELL_API_KEY=your-retell-api-key-here

# =============================================================================
# OPTIONAL ENVIRONMENT VARIABLES
# =============================================================================

# Google OAuth (if using Google Sign-In)
# Get these from Google Cloud Console: https://console.cloud.google.com
# GOOGLE_CLIENT_ID=your-google-client-id-here
# GOOGLE_CLIENT_SECRET=your-google-client-secret-here

# =============================================================================
# DIGITAL OCEAN SPECIFIC NOTES
# =============================================================================

# 1. ${APP_URL} is a Digital Ocean variable that auto-populates with your app's URL
#    Example: https://your-app-abc123.ondigitalocean.app
#
# 2. ${bookedsolid-db.DATABASE_URL} references the database service defined in app.yaml
#    This automatically connects your app to the PostgreSQL database
#
# 3. All secrets should be marked as "Secret" type in Digital Ocean dashboard
#    This encrypts them and hides them in the UI
#
# 4. Environment variables set to "RUN_AND_BUILD_TIME" are available during:
#    - Build process (npm run build)
#    - Runtime (npm start)
#
# 5. To update environment variables:
#    - Go to your app in Digital Ocean dashboard
#    - Click "Settings" tab
#    - Click on your service (web)
#    - Scroll to "Environment Variables"
#    - Click "Edit" to add/modify variables
#    - Click "Save" and redeploy

# =============================================================================
# HOW TO ADD THESE TO DIGITAL OCEAN
# =============================================================================

# Method 1: Using the Dashboard (Recommended)
# 1. Go to https://cloud.digitalocean.com/apps
# 2. Select your app
# 3. Click "Settings" > Select "web" service
# 4. Scroll to "Environment Variables"
# 5. Click "Edit"
# 6. For each variable:
#    - Click "Add Variable"
#    - Enter Key and Value
#    - Select "Encrypt" for secrets
#    - Choose "RUN_AND_BUILD_TIME" for scope
# 7. Click "Save"
# 8. App will automatically redeploy

# Method 2: Using doctl CLI
# 1. Install doctl: https://docs.digitalocean.com/reference/doctl/how-to/install/
# 2. Authenticate: doctl auth init
# 3. Set variables:
#    doctl apps update YOUR_APP_ID --spec .do/app.yaml

# =============================================================================
# VALIDATION CHECKLIST
# =============================================================================

# Before deploying, verify:
# [ ] NEXTAUTH_SECRET is set to a random 32-character string
# [ ] NEXTAUTH_URL is set to ${APP_URL} or your custom domain
# [ ] DATABASE_URL references the correct database service
# [ ] RETELL_WEBHOOK_SECRET matches your Retell dashboard
# [ ] RETELL_API_KEY is valid and active
# [ ] All secrets are marked as "Secret" type in Digital Ocean
# [ ] Google OAuth credentials are correct (if using)

# =============================================================================
# SECURITY BEST PRACTICES
# =============================================================================

# 1. Never commit real values to Git
# 2. Generate strong random secrets
# 3. Rotate secrets regularly (every 90 days)
# 4. Use different secrets for dev/staging/prod
# 5. Limit access to Digital Ocean dashboard
# 6. Enable 2FA on Digital Ocean account
# 7. Monitor logs for unauthorized access
# 8. Review environment variables periodically

# =============================================================================
# TROUBLESHOOTING
# =============================================================================

# Issue: "NEXTAUTH_SECRET is not set"
# Solution: Ensure NEXTAUTH_SECRET is added to environment variables
#           Mark it as "Secret" type and "RUN_AND_BUILD_TIME" scope

# Issue: "Database connection failed"
# Solution: Verify DATABASE_URL is correctly referencing ${bookedsolid-db.DATABASE_URL}
#           Check that database service is running in Digital Ocean dashboard

# Issue: "Retell webhook verification failed"
# Solution: Ensure RETELL_WEBHOOK_SECRET matches exactly in both:
#           - Digital Ocean environment variables
#           - Retell AI dashboard webhook settings

# Issue: "Environment variable not available at build time"
# Solution: Change scope from "RUN_TIME" to "RUN_AND_BUILD_TIME"

# Issue: "Google OAuth redirect URI mismatch"
# Solution: Update authorized redirect URIs in Google Cloud Console:
#           https://your-app.ondigitalocean.app/api/auth/callback/google

# =============================================================================
# GENERATING SECRETS
# =============================================================================

# NEXTAUTH_SECRET (Linux/macOS):
# openssl rand -base64 32

# NEXTAUTH_SECRET (Windows PowerShell):
# [Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Minimum 0 -Maximum 256 }))

# NEXTAUTH_SECRET (Online):
# https://generate-secret.vercel.app/32

# =============================================================================
# DATABASE URL FORMAT
# =============================================================================

# PostgreSQL connection string format:
# postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE?schema=public&connection_limit=10

# Digital Ocean auto-generates this format:
# postgresql://bookedsolid_user:random_password@db-postgresql-nyc1-12345.ondigitalocean.com:25060/bookedsolid?sslmode=require

# Connection pool settings (optional, add to DATABASE_URL):
# ?connection_limit=10&pool_timeout=20&connect_timeout=10

# =============================================================================
# CUSTOM DOMAIN CONFIGURATION
# =============================================================================

# After adding a custom domain in Digital Ocean:
# 1. Update NEXTAUTH_URL to your custom domain:
#    NEXTAUTH_URL=https://dashboard.yourdomain.com
#
# 2. Update Google OAuth redirect URIs:
#    https://dashboard.yourdomain.com/api/auth/callback/google
#
# 3. Update Retell webhook URL:
#    https://dashboard.yourdomain.com/api/webhooks/retell
#
# 4. Wait for SSL certificate to provision (1-5 minutes)

# =============================================================================
# MIGRATION NOTES
# =============================================================================

# Database migrations run automatically via the pre-deploy job
# No manual migration needed on first deploy

# If you need to run migrations manually:
# 1. Access app console in Digital Ocean dashboard
# 2. Run: npx prisma migrate deploy

# To seed the database with initial data:
# 1. Access app console
# 2. Run: npm run db:seed
